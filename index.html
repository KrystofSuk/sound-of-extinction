<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width, maximum-scale=1.0, user-scalable=0"/>
    <title>The sound of extinction</title>

    <link rel="stylesheet" href="style.css" />

    <script src="lib/p5.js"></script>
    <script src="lib/p5.sound.js"></script>
    <script src="lib/jquery.min.js"></script>

    <script src="sketch.js"></script>

    <script src="misc.js"></script>
  </head>

  <body>
    <div class="full-width full-height flex-container" id="intro-page">
      <h1>THE SOUND OF EXTINCTION</h1>
      <button class="gray-bg white-fg default-button" id="to-menu-button" onclick="ToMenu()">Continue</button>
    </div>

    <div class="full-width full-height flex-container" id="menu-page">
      <h2>CHOOSE BIOME</h2>
      <div class="flex-container-width full-width">
          <button class="gray-bg white-fg default-button biome-button flex-container" id="biome0" onclick="ToBiome(0, this.id)" value="Forest">
            Forest
            <!-- Attribution: https://freeicons.io/real-estate-icons-2/real%20estate-forest-icon-1610 -->
            <img class="biome-image" src="data/img/forest.svg" />
          </button>
          
          <button class="gray-bg white-fg default-button biome-button flex-container" id="biome3" onclick="ToBiome(3, this.id)" value="Desert">
            Desert
            <!-- Attribution: https://www.svgrepo.com/svg/25733/cactus -->
            <img class="biome-image" src="data/img/desert.svg" />
          </button>
      </div>
    </div>

    <div class="full-width full-height flex-container" id="visual-page">
      <h2 id="biome-heading">BIOME</h2>
      <div class="flex-container-width full-width">
        <div class="width3 flex-container">
          <button class="gray-bg white-fg default-button sound-button" id="sound0" onclick="PlaySound(1, this.id)">Mongoose lemur</button>
          <button class="gray-bg white-fg default-button sound-button" id="sound1" onclick="PlaySound(2, this.id)">Western gorilla</button>
        </div>

        <div class="width3 flex-container" id="spectrogram-area"></div>

        <div class="width3 flex-container">
          <button class="gray-bg white-fg default-button sound-button" id="sound2" onclick="PlaySound(3, this.id)">Alagoas curassow</button>
          <button class="gray-bg white-fg default-button sound-button" id="sound3" onclick="PlaySound(4, this.id)">Bornean orangutan</button>
        </div>
      </div>

      <div class="fixed-bottom full-width light-gray-bg timeline" id="timeline-base">
        <div class="fixed-bottom gray-bg timeline" id="timeline-fill"></div>
      </div>
    </div>

    <div class="full-width full-height flex-container" id="final-page">
      <h2 class="final-heading">THIS SOUND CAN NO LONGER BE HEARD IN THE WILD</h2>
      <h2 class="final-text">All of the species either already went extinct, or are critically engdangered</h2>

      <div class="flex-container" id="final-spectrogram-area"></div>
      
      <div class="flex-container-width full-width">
        <button class="gray-bg white-fg default-button menu-button flex-container"onclick="DownloadImage()">
          Save image
        </button>

        <button class="gray-bg white-fg default-button menu-button flex-container"onclick="ToMenu()">
          Listen again
        </button>
      </div>
    </div>

    <script>
      let intro = $("#intro-page");
      let menu = $("#menu-page");
      let visual = $("#visual-page");
      let final = $("#final-page");

      menu.hide();
      visual.hide();
      final.hide();

      // Switch to biome menu
      function ToMenu() {
        final.hide();
        intro.hide();
        menu.show();
      }

      // Switch to visualization page
      function ToBiome(biome, id) {
        menu.hide();
        visual.show();

        ResetScene();

        ChangeTitle(biome, id);
        GeneratePoints();
        SetBiome(biome);

        setTimeout(Timer, 1000 / 24);
        PlaySound(0, undefined, true);
      }
      
      // Switch to final page
      function ToFinal() {
        visual.hide();
        final.show();
      }

      // Changes the title of vizualization page according to chosen biome
      function ChangeTitle(biome, id) {
        if (!document.getElementById) {
          return;
        }
        var title = document.getElementById(id).value;

        var biomeHeading = document.getElementById("biome-heading");
        biomeHeading.firstChild.nodeValue = title.toUpperCase();
      }

      // Dynamically generates points on timeline and saves their x coordinates
      function GeneratePoints() {
        let margins = [40, 50, 75, 90];

        for (let i = 0; i < margins.length; i++) {
          let point = document.createElement('div');

          point.id = 'point' + i;
          point.className = 'fixed-bottom timeline-point';
          point.style.marginLeft = str(margins[i]) + "%";

          document.getElementById("timeline-base").appendChild(point);
        }
      }
    </script>
  </body>
</html>
